<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Penn Forced Aligner (Legacy) | Legacy Pages of the Corpus Phonetics Tutorial</title>
  <meta name="description" content="The legacy pages of the corpus phonetics tutorial" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Penn Forced Aligner (Legacy) | Legacy Pages of the Corpus Phonetics Tutorial" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://eleanorchodroff.com/tutorial/legacy/" />
  
  <meta property="og:description" content="The legacy pages of the corpus phonetics tutorial" />
  <meta name="github-repo" content="echodroff/corpus-phonetics-tutorial" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Penn Forced Aligner (Legacy) | Legacy Pages of the Corpus Phonetics Tutorial" />
  
  <meta name="twitter:description" content="The legacy pages of the corpus phonetics tutorial" />
  

<meta name="author" content="Eleanor Chodroff" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="fave-align-legacy.html"/>

<script src="libs/header-attrs-2.16/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><b><a href="https://eleanorchodroff.com/tutorial/index.html">Corpus Phonetics Tutorial</a></b></li>

<li class="divider"></li>
<li><a href="index.html#introduction" id="toc-introduction"><span class="toc-section-number">1</span> Introduction<span></span></a></li>
<li><a href="montreal-forced-aligner-v1-legacy.html#montreal-forced-aligner-v1-legacy" id="toc-montreal-forced-aligner-v1-legacy"><span class="toc-section-number">2</span> Montreal Forced Aligner v1 (Legacy)<span></span></a>
<ul>
<li><a href="montreal-forced-aligner-v1-legacy.html#overview" id="toc-overview"><span class="toc-section-number">2.1</span> Overview<span></span></a></li>
<li><a href="montreal-forced-aligner-v1-legacy.html#setup" id="toc-setup"><span class="toc-section-number">2.2</span> Setup<span></span></a>
<ul>
<li><a href="montreal-forced-aligner-v1-legacy.html#wav-files" id="toc-wav-files"><span class="toc-section-number">2.2.1</span> Wav files<span></span></a></li>
<li><a href="montreal-forced-aligner-v1-legacy.html#transcripts" id="toc-transcripts"><span class="toc-section-number">2.2.2</span> Transcripts<span></span></a></li>
<li><a href="montreal-forced-aligner-v1-legacy.html#pronunciation-lexicon" id="toc-pronunciation-lexicon"><span class="toc-section-number">2.2.3</span> Pronunciation lexicon<span></span></a></li>
<li><a href="montreal-forced-aligner-v1-legacy.html#acoustic-models" id="toc-acoustic-models"><span class="toc-section-number">2.2.4</span> Acoustic models<span></span></a></li>
</ul></li>
<li><a href="montreal-forced-aligner-v1-legacy.html#grapheme-to-phoneme-models" id="toc-grapheme-to-phoneme-models"><span class="toc-section-number">2.3</span> Grapheme-to-phoneme models<span></span></a></li>
<li><a href="montreal-forced-aligner-v1-legacy.html#running-the-aligner" id="toc-running-the-aligner"><span class="toc-section-number">2.4</span> Running the aligner<span></span></a></li>
<li><a href="montreal-forced-aligner-v1-legacy.html#tips-and-tricks" id="toc-tips-and-tricks"><span class="toc-section-number">2.5</span> Tips and tricks<span></span></a></li>
</ul></li>
<li><a href="fave-align-legacy.html#fave-align-legacy" id="toc-fave-align-legacy"><span class="toc-section-number">3</span> FAVE-align (Legacy)<span></span></a>
<ul>
<li><a href="fave-align-legacy.html#overview-1" id="toc-overview-1"><span class="toc-section-number">3.1</span> Overview<span></span></a></li>
<li><a href="fave-align-legacy.html#installation" id="toc-installation"><span class="toc-section-number">3.2</span> Installation<span></span></a></li>
<li><a href="fave-align-legacy.html#running-the-aligner-1" id="toc-running-the-aligner-1"><span class="toc-section-number">3.3</span> Running the aligner<span></span></a></li>
</ul></li>
<li><a href="penn-forced-aligner-legacy.html#penn-forced-aligner-legacy" id="toc-penn-forced-aligner-legacy"><span class="toc-section-number">4</span> Penn Forced Aligner (Legacy)<span></span></a>
<ul>
<li><a href="penn-forced-aligner-legacy.html#overview-2" id="toc-overview-2"><span class="toc-section-number">4.1</span> Overview<span></span></a></li>
<li><a href="penn-forced-aligner-legacy.html#prerequisites" id="toc-prerequisites"><span class="toc-section-number">4.2</span> Prerequisites<span></span></a></li>
<li><a href="penn-forced-aligner-legacy.html#modifying-the-lexicon" id="toc-modifying-the-lexicon"><span class="toc-section-number">4.3</span> Modifying the lexicon<span></span></a></li>
<li><a href="penn-forced-aligner-legacy.html#running-the-aligner-2" id="toc-running-the-aligner-2"><span class="toc-section-number">4.4</span> Running the aligner<span></span></a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Legacy Pages of the Corpus Phonetics Tutorial</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="penn-forced-aligner-legacy" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> Penn Forced Aligner (Legacy)<a href="penn-forced-aligner-legacy.html#penn-forced-aligner-legacy" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="overview-2" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Overview<a href="penn-forced-aligner-legacy.html#overview-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>What does the Penn Forced Aligner do?</strong> The Penn Forced Aligner takes a sound file and the corresponding transcript of speech and returns a Praat TextGrid with phone and word alignments. You can find the website <a href="https://www.ling.upenn.edu/phonetics/old_website_2015/p2fa/" target="_blank">here</a>.</p>
<p><strong>What does it include?</strong> The system comes with <em>pre-trained acoustic models</em> of American English (AE) speech from the SCOTUS corpus, built with the HTK Speech Recognition Toolkit. The section on <a href="https://www.eleanorchodroff.com/tutorial/kaldi/introduction.html">Kaldi</a> introduces a similar, but alternative system to HTK, in case you’d like to train your own acoustic models from scratch. In addition to the acoustic models, the download also includes a large lexicon of words based on the CMU Pronouncing Dictionary. The dictionary contains over 100,000 words with their standard pronunciation transcriptions in <a href="http://en.wikipedia.org/wiki/Arpabet" target="_blank">Arpabet</a>. Arpabet is a machine-readable phonetic alphabet of General American English with stress marked on the vowels. While I have, perhaps wrongly, used the Penn Forced Aligner to create phonetic alignments for other languages, those transcriptions had to be forced into Arpabet phones. For a quick alignment, this works fine, but please be advised: the acoustic models of the Penn Forced Aligner are trained on American English, so any speech it is given will be treated like American English. Unless manual adjustments follow the automatic alignment, the PFA alignment would not be ideal for most non-AE phonetic analyses. Again, see the section on <a href="https://www.eleanorchodroff.com/tutorial/kaldi/introduction.html">Kaldi</a> if you would like to create acoustic models for a different language or dialect.</p>
</div>
<div id="prerequisites" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Prerequisites<a href="penn-forced-aligner-legacy.html#prerequisites" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>HTK Toolkit Version 3.4
<ul>
<li>Version 3.4.1 will <strong>not</strong> work</li>
<li>Download here: <a href="http://htk.eng.cam.ac.uk/" target="_blank">http://htk.eng.cam.ac.uk/</a></li>
<li>Many run into issues installing this, but detailed installation instructions (and additional tutorial notes) can be found <a href="http://linguisticmystic.com/2014/02/12/penn-forced-aligner-on-mac-os-x/" target="_blank">here</a>. <strong>Update</strong> as of November 11, 2018: this website (linguisticmystic.com) no longer works, but covered how to install the Penn Forced Aligner on a Mac. The Penn Forced Aligner is no longer being maintained, and has instead been replaced by FAVE (section <a href="fave-align-legacy.html#fave-align-legacy">3</a>). The corresponding prerequisites for HTK installation on Mac are now covered on the <a href="https://github.com/JoFrhwld/FAVE/wiki/HTK-on-OS-X" target="_blank">FAVE wiki</a>).</li>
</ul></li>
<li>Python 2.5 or 2.6
<ul>
<li>Pre-installed on Macs, but you can double-check by opening the terminal and typing python. This will return the version installed. I have been using Version 2.7.6 and have not had any issues running the aligner. Since you’ve typed python, the terminal is now running with the assumption of python syntax. You want to exit this to get back to its Unix base; to do this, type <code>exit()</code> or <code>quit()</code>. If you have an earlier version of Python, you may need to type <code>exit</code>.</li>
</ul></li>
<li>SoX
<ul>
<li>Download here: <a href="http://sourceforge.net/projects/sox/" target="_blank">http://sourceforge.net/projects/sox/</a></li>
</ul></li>
</ul>
</div>
<div id="modifying-the-lexicon" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Modifying the lexicon<a href="penn-forced-aligner-legacy.html#modifying-the-lexicon" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>After downloading the Penn Forced Aligner, you should now have a directory named <code>p2fa</code>. Before beginning any of the following steps, take note of the parent directory and path, as you will need to direct your terminal to the exact <code>p2fa</code> location. For example, my <code>p2fa</code> directory is located in <code>/Users/Eleanor</code>. I can direct my terminal now to that location and view the contents of that directory by typing the following:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="penn-forced-aligner-legacy.html#cb9-1" aria-hidden="true" tabindex="-1"></a>cd <span class="sc">/</span>Users<span class="sc">/</span>Eleanor<span class="sc">/</span></span>
<span id="cb9-2"><a href="penn-forced-aligner-legacy.html#cb9-2" aria-hidden="true" tabindex="-1"></a>ls</span></code></pre></div>
<p>Once you’ve located the <code>p2fa</code> directory, you can find the lexicon in <code>p2fa/model/dict</code>.</p>
<p>Despite the lack of a <code>.txt</code> extension, <code>dict</code> is a text file, making it quite easy to add words and non-words alike. You’ll want to make sure that all words in your transcript are indeed in the dictionary. This can be done by converting your transcript into a word list and comparing it against the dictionary.</p>
<p>First, you’ll need a copy of your transcript in a text file called <code>fulltranscript.txt</code>. (Actually, you can call it whatever you want; just make sure to change the name in the code!)</p>
<p>In the terminal, navigate to the location of your transcript and then we can use the long code to create a list of all unique words in the transcript. My <code>fulltranscript.txt</code> is located in <code>/Users/Eleanor/myCorpus</code>. You’ll need to change that part to match your file location.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="penn-forced-aligner-legacy.html#cb10-1" aria-hidden="true" tabindex="-1"></a>cd <span class="sc">/</span>Users<span class="sc">/</span>Eleanor<span class="sc">/</span>myCorpus</span>
<span id="cb10-2"><a href="penn-forced-aligner-legacy.html#cb10-2" aria-hidden="true" tabindex="-1"></a>tr <span class="st">&#39; &#39;</span> <span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span> <span class="sc">&lt;</span> fulltranscript.txt <span class="sc">|</span> tr <span class="st">&#39;[a-z]&#39;</span> <span class="st">&#39;[A-Z]&#39;</span> <span class="sc">|</span> \</span>
<span id="cb10-3"><a href="penn-forced-aligner-legacy.html#cb10-3" aria-hidden="true" tabindex="-1"></a>sed <span class="st">&#39;/^$/d&#39;</span> <span class="sc">|</span> sed <span class="st">&#39;/[.,?!;:]/d&#39;</span> <span class="sc">|</span> sort <span class="sc">|</span> uniq <span class="sc">-</span>c <span class="sc">|</span> sed <span class="st">&#39;s/^ *//&#39;</span> <span class="sc">|</span> \</span>
<span id="cb10-4"><a href="penn-forced-aligner-legacy.html#cb10-4" aria-hidden="true" tabindex="-1"></a>sort <span class="sc">-</span>r <span class="sc">-</span>n <span class="sc">&gt;</span> fulltranscript_words.txt</span></code></pre></div>
<p>The above clearly does a whole slew of functions. It will first take your transcript, separate each word with a new line (<code>tr ' ' '\n' &lt; fulltranscript.txt</code>), capitalize all letters (<code>tr '[a-z]' '[A-Z]'</code>), delete blank lines (<code>sed '/^$/d'</code>), remove punctuation (<code>sed '/[.,?!;:]/d'</code>), sort the words (<code>sort</code>), remove duplicate words (<code>uniq -c</code>), delete blank lines/trailing white space again (<code>sed 's/^ *//'</code>), sort again and give you a count of how many times each word appears in the transcript (<code>sort -r -n &gt; fulltranscript_words.txt</code>).</p>
<p>The following code will find the word pronunciations in the CMU dictionary. This is accomplished by taking the words and putting them into the regular expression format for locating the beginning of a line (<code>^</code>). This results in <code>tmp.txt</code>. That file is then compared against the CMU dictionary. If the word is in the dictionary, then the dictionary line is extracted such that you have both the word and its pronunciation. Note that when using the <code>cut</code> command, the default cut is tab (<code>cut -f 2</code>), but if the delimiter is anything other than tab (space, comma, etc.), it can be specified with <code>cut -d 'my delimiter' -f 2 myfile.txt</code>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="penn-forced-aligner-legacy.html#cb11-1" aria-hidden="true" tabindex="-1"></a>cut <span class="sc">-</span>d <span class="st">&#39; &#39;</span> <span class="sc">-</span>f <span class="dv">2</span> fulltranscript_<span class="sc">**</span>words<span class="sc">**</span>.txt <span class="sc">|</span> sed <span class="st">&#39;s/^/^/&#39;</span> <span class="sc">|</span> sed <span class="st">&#39;s/$/  /&#39;</span> <span class="sc">&gt;</span> tmp.txt</span>
<span id="cb11-2"><a href="penn-forced-aligner-legacy.html#cb11-2" aria-hidden="true" tabindex="-1"></a>egrep <span class="sc">--</span>file<span class="ot">=</span>tmp.txt <span class="sc">/</span>Users<span class="sc">/</span>Eleanor<span class="sc">/</span>p2fa<span class="sc">/</span>model<span class="sc">/</span>dict <span class="sc">&gt;</span> fulltranscript_words_pron.txt;</span></code></pre></div>
<p>You then need to determine which words were skipped in this process, i.e., the words missing from the CMU dictionary. This can be done by comparing the final <code>fulltranscript_words_pron.txt</code> against the original <code>fulltranscript_words.txt</code>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="penn-forced-aligner-legacy.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extracts and sorts relevant columns and stores in tmp file</span></span>
<span id="cb12-2"><a href="penn-forced-aligner-legacy.html#cb12-2" aria-hidden="true" tabindex="-1"></a>sort <span class="sc">-</span>k <span class="dv">2</span> fulltranscript_words.txt <span class="sc">&gt;</span> tmp1.txt</span>
<span id="cb12-3"><a href="penn-forced-aligner-legacy.html#cb12-3" aria-hidden="true" tabindex="-1"></a>sort <span class="sc">-</span>k <span class="dv">1</span> fulltranscript_words_pron.txt <span class="sc">&gt;</span> tmp2.txt</span>
<span id="cb12-4"><a href="penn-forced-aligner-legacy.html#cb12-4" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb12-5"><a href="penn-forced-aligner-legacy.html#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># merges the two files to list words, word count, and pron</span></span>
<span id="cb12-6"><a href="penn-forced-aligner-legacy.html#cb12-6" aria-hidden="true" tabindex="-1"></a>join <span class="sc">-</span><span class="dv">1</span> <span class="dv">2</span> <span class="sc">-</span><span class="dv">2</span> <span class="dv">1</span> tmp1.txt tmp2.txt <span class="sc">&gt;</span> fulltranscript_words_pron2.txt</span>
<span id="cb12-7"><a href="penn-forced-aligner-legacy.html#cb12-7" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb12-8"><a href="penn-forced-aligner-legacy.html#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># lists words with missing pronunciations</span></span>
<span id="cb12-9"><a href="penn-forced-aligner-legacy.html#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co"># these are the words you need to add to the dictionary</span></span>
<span id="cb12-10"><a href="penn-forced-aligner-legacy.html#cb12-10" aria-hidden="true" tabindex="-1"></a>join <span class="sc">-</span>v <span class="dv">1</span> <span class="sc">-</span><span class="dv">1</span> <span class="dv">2</span> <span class="sc">-</span><span class="dv">2</span> <span class="dv">1</span> tmp1.txt tmp2.txt <span class="sc">&gt;</span> fulltranscript_words_missing_pron.txt</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="penn-forced-aligner-legacy.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extras:</span></span>
<span id="cb13-2"><a href="penn-forced-aligner-legacy.html#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># get count of word types</span></span>
<span id="cb13-3"><a href="penn-forced-aligner-legacy.html#cb13-3" aria-hidden="true" tabindex="-1"></a>wc <span class="sc">-</span>l <span class="sc">&lt;</span> fulltranscript_words.txt</span>
<span id="cb13-4"><a href="penn-forced-aligner-legacy.html#cb13-4" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb13-5"><a href="penn-forced-aligner-legacy.html#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># get count of phone types</span></span>
<span id="cb13-6"><a href="penn-forced-aligner-legacy.html#cb13-6" aria-hidden="true" tabindex="-1"></a>wc <span class="sc">-</span>l <span class="sc">&lt;</span> fulltranscript_words_pron.txt</span>
<span id="cb13-7"><a href="penn-forced-aligner-legacy.html#cb13-7" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb13-8"><a href="penn-forced-aligner-legacy.html#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># get count of phone tokens</span></span>
<span id="cb13-9"><a href="penn-forced-aligner-legacy.html#cb13-9" aria-hidden="true" tabindex="-1"></a>cut <span class="sc">-</span>d<span class="st">&#39; &#39;</span> <span class="sc">-</span>f <span class="dv">3</span><span class="sc">-</span> <span class="er">&lt;</span> fulltranscript_words_pron.txt <span class="sc">|</span> tr <span class="st">&#39; &#39;</span> <span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span> <span class="sc">|</span> sort <span class="sc">|</span> uniq <span class="sc">-</span>c <span class="sc">|</span> \</span>
<span id="cb13-10"><a href="penn-forced-aligner-legacy.html#cb13-10" aria-hidden="true" tabindex="-1"></a>sed <span class="st">&#39;s/^ *//&#39;</span> <span class="sc">|</span> sort <span class="sc">-</span>r <span class="sc">-</span>n <span class="sc">&gt;</span> fulltranscript_phones.txt</span></code></pre></div>
<p>Lexical entries need to be added in the same format as the rest of the dictionary, which is the word in all caps followed by two spaces and the CMU pronunciation with stress on the vowel. For example:</p>
<div id="textfile">
<p>KLATT K L AE1 T
ELEANOR EH1 L AH0 N AO2 R
ELEANOR EH1 L AH0 N ER2</p>
</div>
<p>Multiple pronunciation variants are fine (this can even be used to test some interesting hypotheses). CMU provides a nice tool for converting standard spellings of words and non-words into the correct pronunciation. This can be found here: <a href="http://www.speech.cs.cmu.edu/tools/lextool.html" target="_blank">http://www.speech.cs.cmu.edu/tools/lextool.html</a>.</p>
<p>After running this tool, you will need to add the stress value to the vowels (1 = primary, 0 = unstressed, 2 = secondary). You can always refer to similar words in the dictionary for an example.</p>
</div>
<div id="running-the-aligner-2" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Running the aligner<a href="penn-forced-aligner-legacy.html#running-the-aligner-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The standard implementation of the Penn Forced Aligner will process a single wav file and transcript, returning the phone and word alignment on a Praat TextGrid.</p>
<p>Before beginning this part of the tutorial, make sure that all the words in your transcript are in the included lexicon, <code>p2fa/model/dict</code>. If you’re not sure or know that they are not, please visit Section <a href="penn-forced-aligner-legacy.html#modifying-the-lexicon">4.3</a>.</p>
Ingredients:<br />
* Wav file of recording<br />
* Corresponding transcript. Example below:<br />

<div id="textfile">
<p>SAY TUTT AGAIN</p>
<p>SAY PAT AGAIN</p>
<p>SAY DOT AGAIN</p>
</div>
<p>The transcript should contain the words with spaces between them; these are standardly capitalized, but the aligner will accept lowercase and uppercase letters. Line breaks are fine, as are apostrophes, as long as that spelling is in the dictionary. All punctuation should be removed. Others have suggested adding an “<code>sp</code>” or space between words and sentences. This is not necessary. The aligner will determiner whether or not a small space or silence is present.</p>
<p>An important note is that the aligner can derail if there is untranscribed noise or speech in the recording. In my experience, it’s not too bad at recovering after a short while, but it’s best to avoid that situation. This can be accomplished by giving it smaller portions of the wav file, or ensuring that all noise and extraneous speech is explicitly transcribed. Smaller portions of the wav file can be created manually by extracting the relevant clip(s). Alternatively, a modified version of the script can process relevant sections of speech defined by their start and end times. Yet another option is to transcribe noise as <code>{NS}</code> and silence as <code>{SP}</code>. I have not tried this method, so I do not know how robust it is to extraneous speech.</p>
<p>To process a single wav file and transcript, direct the terminal to the directory containing the Penn Forced Aligner <code>align.py</code> script with <code>cd</code>, then type the second command. The arguments to the align.py script are the locations of the wav file and transcript file. The script creates the aligned TextGrid as output (<code>subj01.TextGrid</code>, but you can call it whatever you want).</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="penn-forced-aligner-legacy.html#cb14-1" aria-hidden="true" tabindex="-1"></a>cd <span class="sc">~</span><span class="er">/</span>p2fa</span>
<span id="cb14-2"><a href="penn-forced-aligner-legacy.html#cb14-2" aria-hidden="true" tabindex="-1"></a>python align.py <span class="sc">/</span>Users<span class="sc">/</span>Eleanor<span class="sc">/</span>myCorpus<span class="sc">/</span>subj01.wav \</span>
<span id="cb14-3"><a href="penn-forced-aligner-legacy.html#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span>Users<span class="sc">/</span>Eleanor<span class="sc">/</span>myCorpus<span class="sc">/</span>subj01.txt subj01.TextGrid</span></code></pre></div>
<p>And that’s it!</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="fave-align-legacy.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
