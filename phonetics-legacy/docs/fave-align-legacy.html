<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 FAVE-align (Legacy) | Legacy Pages of the Corpus Phonetics Tutorial</title>
  <meta name="description" content="The legacy pages of the corpus phonetics tutorial" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="3 FAVE-align (Legacy) | Legacy Pages of the Corpus Phonetics Tutorial" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://eleanorchodroff.com/tutorial/legacy/" />
  
  <meta property="og:description" content="The legacy pages of the corpus phonetics tutorial" />
  <meta name="github-repo" content="echodroff/corpus-phonetics-tutorial" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 FAVE-align (Legacy) | Legacy Pages of the Corpus Phonetics Tutorial" />
  
  <meta name="twitter:description" content="The legacy pages of the corpus phonetics tutorial" />
  

<meta name="author" content="Eleanor Chodroff" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="montreal-forced-aligner-v1-legacy.html"/>
<link rel="next" href="penn-forced-aligner-legacy.html"/>
<script src="libs/header-attrs-2.16/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><b><a href="https://eleanorchodroff.com/tutorial/index.html">Corpus Phonetics Tutorial</a></b></li>

<li class="divider"></li>
<li><a href="index.html#introduction" id="toc-introduction"><span class="toc-section-number">1</span> Introduction<span></span></a></li>
<li><a href="montreal-forced-aligner-v1-legacy.html#montreal-forced-aligner-v1-legacy" id="toc-montreal-forced-aligner-v1-legacy"><span class="toc-section-number">2</span> Montreal Forced Aligner v1 (Legacy)<span></span></a>
<ul>
<li><a href="montreal-forced-aligner-v1-legacy.html#overview" id="toc-overview"><span class="toc-section-number">2.1</span> Overview<span></span></a></li>
<li><a href="montreal-forced-aligner-v1-legacy.html#setup" id="toc-setup"><span class="toc-section-number">2.2</span> Setup<span></span></a>
<ul>
<li><a href="montreal-forced-aligner-v1-legacy.html#wav-files" id="toc-wav-files"><span class="toc-section-number">2.2.1</span> Wav files<span></span></a></li>
<li><a href="montreal-forced-aligner-v1-legacy.html#transcripts" id="toc-transcripts"><span class="toc-section-number">2.2.2</span> Transcripts<span></span></a></li>
<li><a href="montreal-forced-aligner-v1-legacy.html#pronunciation-lexicon" id="toc-pronunciation-lexicon"><span class="toc-section-number">2.2.3</span> Pronunciation lexicon<span></span></a></li>
<li><a href="montreal-forced-aligner-v1-legacy.html#acoustic-models" id="toc-acoustic-models"><span class="toc-section-number">2.2.4</span> Acoustic models<span></span></a></li>
</ul></li>
<li><a href="montreal-forced-aligner-v1-legacy.html#grapheme-to-phoneme-models" id="toc-grapheme-to-phoneme-models"><span class="toc-section-number">2.3</span> Grapheme-to-phoneme models<span></span></a></li>
<li><a href="montreal-forced-aligner-v1-legacy.html#running-the-aligner" id="toc-running-the-aligner"><span class="toc-section-number">2.4</span> Running the aligner<span></span></a></li>
<li><a href="montreal-forced-aligner-v1-legacy.html#tips-and-tricks" id="toc-tips-and-tricks"><span class="toc-section-number">2.5</span> Tips and tricks<span></span></a></li>
</ul></li>
<li><a href="fave-align-legacy.html#fave-align-legacy" id="toc-fave-align-legacy"><span class="toc-section-number">3</span> FAVE-align (Legacy)<span></span></a>
<ul>
<li><a href="fave-align-legacy.html#overview-1" id="toc-overview-1"><span class="toc-section-number">3.1</span> Overview<span></span></a></li>
<li><a href="fave-align-legacy.html#installation" id="toc-installation"><span class="toc-section-number">3.2</span> Installation<span></span></a></li>
<li><a href="fave-align-legacy.html#running-the-aligner-1" id="toc-running-the-aligner-1"><span class="toc-section-number">3.3</span> Running the aligner<span></span></a></li>
</ul></li>
<li><a href="penn-forced-aligner-legacy.html#penn-forced-aligner-legacy" id="toc-penn-forced-aligner-legacy"><span class="toc-section-number">4</span> Penn Forced Aligner (Legacy)<span></span></a>
<ul>
<li><a href="penn-forced-aligner-legacy.html#overview-2" id="toc-overview-2"><span class="toc-section-number">4.1</span> Overview<span></span></a></li>
<li><a href="penn-forced-aligner-legacy.html#prerequisites" id="toc-prerequisites"><span class="toc-section-number">4.2</span> Prerequisites<span></span></a></li>
<li><a href="penn-forced-aligner-legacy.html#modifying-the-lexicon" id="toc-modifying-the-lexicon"><span class="toc-section-number">4.3</span> Modifying the lexicon<span></span></a></li>
<li><a href="penn-forced-aligner-legacy.html#running-the-aligner-2" id="toc-running-the-aligner-2"><span class="toc-section-number">4.4</span> Running the aligner<span></span></a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Legacy Pages of the Corpus Phonetics Tutorial</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="fave-align-legacy" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">3</span> FAVE-align (Legacy)<a href="fave-align-legacy.html#fave-align-legacy" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="overview-1" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Overview<a href="fave-align-legacy.html#overview-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>What does FAVE do?</strong> FAVE is up-to-date implementation of the Penn Forced Aligner covered in section <a href="penn-forced-aligner-legacy.html#penn-forced-aligner-legacy">4</a>. Two programs are included in installation: FAVE-align, which performs forced alignment on American English speech, and FAVE-extract, which performs formant extraction and normalization algorithms. This tutorial focuses on FAVE-align, so future references of FAVE refer to the alignment program only. FAVE takes a sound file and utterance-level transcript (text file) and returns a Praat TextGrid with phone and word alignments. Excellent documentation and instructions for running the aligner can be found on the <a href="https://github.com/JoFrhwld/FAVE/wiki/FAVE-align" target="_blank">FAVE-align website</a>. I will cover many of the instructions again, and try to include some additional tips, but provided installation goes smoothly, this aligner tends to work very well right out of the box.</p>
<p><strong>What does it include?</strong> As in the Penn Forced Aligner, the system comes with <em>pre-trained acoustic models</em> of American English (AE) speech from 25 hours of the SCOTUS corpus, built with the HTK Speech Recognition Toolkit. The section on <a href="https://www.eleanorchodroff.com/tutorial/kaldi/introduction.html" target="_blank">Kaldi</a> introduces a similar, but alternative system to HTK, in case you’d like to train your own acoustic models from scratch. In addition to the acoustic models, the download also includes a large lexicon of words based on the CMU Pronouncing Dictionary. The dictionary contains over 100,000 words with their standard pronunciation transcriptions in <a href="http://en.wikipedia.org/wiki/Arpabet" target="_blank">Arpabet</a>. Arpabet is a machine-readable phonetic alphabet of General American English with stress marked on the vowels. While I have, perhaps wrongly, used the Penn Forced Aligner to create phonetic alignments for other languages, those transcriptions had to be forced into Arpabet phones. For a quick alignment, this works fine, but please be advised: the acoustic models of the Penn Forced Aligner are trained on American English, so any speech it is given will be treated like American English. Unless manual adjustments follow the automatic alignment, the PFA alignment would not be ideal for most non-AE phonetic analyses. See the Montreal Forced Aligner sections for pre-trained acoustic models of additional languages and <a href="https://www.eleanorchodroff.com/tutorial/kaldi/introduction.html" target="_blank">Kaldi</a> if you would like to create custom acoustic models for a particular language or dialect.</p>
</div>
<div id="installation" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Installation<a href="fave-align-legacy.html#installation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Please refer to the <a href="https://github.com/JoFrhwld/FAVE/wiki/Installing-FAVE-align" target="_blank">FAVE website</a> for installation. As of writing, that page currently includes links to OS-specific downloads for each of the prerequisites.</p>
<p>The prerequisites for FAVE are:</p>
<ul>
<li>HTK Toolkit Version 3.4.1
<ul>
<li>Unlike p2fa, version 3.4.1 <strong>will</strong> work</li>
<li>If installing HTK on a Mac, there are additional prerequisites you’ll need. Make sure to check out the <a href="https://github.com/JoFrhwld/FAVE/wiki/HTK-on-OS-X" target="_blank">FAVE wiki</a> for these instructions.</li>
</ul></li>
<li>Python 2.x
<ul>
<li>Pre-installed on Macs, but you can double-check by opening the terminal and typing python. This will return the version installed. I have been using Version 2.7 and have not had any issues running the aligner. Since you’ve typed python, the terminal is now running with the assumption of python syntax. You want to exit this to get back to its Unix base; to do this, type <code>exit()</code> or <code>quit()</code>. If you have an earlier version of Python, you may need to type <code>exit</code>.</li>
</ul></li>
<li>SoX
<ul>
<li>Download here: <a href="http://sourceforge.net/projects/sox/" target="_blank">http://sourceforge.net/projects/sox/</a></li>
</ul></li>
</ul>
<p>To download FAVE, again follow the instructions on the website. FAVE can either be downloaded directly as a .zip or .tar.gz file <a href="https://github.com/JoFrhwld/FAVE/releases" target="_blank">here</a> or cloned via git using the following command:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="fave-align-legacy.html#cb7-1" aria-hidden="true" tabindex="-1"></a>git clone https<span class="sc">:</span><span class="er">//</span>github.com<span class="sc">/</span>JoFrhwld<span class="sc">/</span>FAVE.git</span></code></pre></div>
<p>Cloning the system ensures that any new updates are automatically applied to the system.</p>
</div>
<div id="running-the-aligner-1" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Running the aligner<a href="fave-align-legacy.html#running-the-aligner-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>FAVE requires a wav file and a corresponding transcript that must adhere to a precise format, which is described below. Unlike some other alignment systems, the wav file does not need to have a sampling rate of 16 kHz. During alignment, the system will automatically create a temporary file with this sampling rate.</p>
<p>The text file must be tab-delimited (.txt) with the following five columns:</p>
<ol style="list-style-type: decimal">
<li>Speaker ID</li>
<li>Speaker name</li>
<li>Onset time (seconds)</li>
<li>Offset time (seconds)</li>
<li>Transcription of speech between onset and offset times</li>
</ol>
<p>Some notes I’ve taken that could be useful:</p>
<ul>
<li><p>The speaker ID can be the same as the speaker name</p></li>
<li><p>You can make up a very large number as a hack for indicating that the offset time should be the end of the file. The aligner will produce a warning, but still complete the alignment.</p></li>
<li><p>FAVE sometimes struggles with spontaneous speech, though I imagine any forced alignment system might struggle with this. When the total number of phones in the transcript exceeded the total utterance time under the assumption that a phone is 30 ms, then the aligner produced overlapping intervals. This resulted in areas of Praat TextGrids with overlapping intervals which are visible but no longer functional, and now somewhat useless. It could be a bug in either Praat or FAVE.</p></li>
<li><p>Some people have asked me how to align multiple files at once. This can be accomplished with a for loop in the shell script that uses regular expression matching to loop through files. Assuming the transcripts and wav files are in the same folder and differ only in their extension (.txt vs .wav), then you could use the following code (make sure to remove the backslashes and run as one line of code):</p></li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="fave-align-legacy.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># direct shell to location of FAAValign.py script</span></span>
<span id="cb8-2"><a href="fave-align-legacy.html#cb8-2" aria-hidden="true" tabindex="-1"></a>cd <span class="sc">/</span>Users<span class="sc">/</span>Eleanor<span class="sc">/</span>FAVE<span class="sc">/</span>FAVE<span class="sc">-</span>align</span>
<span id="cb8-3"><a href="fave-align-legacy.html#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="fave-align-legacy.html#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># loop through transcript files in a second directory that contains </span></span>
<span id="cb8-5"><a href="fave-align-legacy.html#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># the transcript files and like-named wav files</span></span>
<span id="cb8-6"><a href="fave-align-legacy.html#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="cf">in</span> <span class="sc">/</span>Users<span class="sc">/</span>Eleanor<span class="sc">/</span>myCorpus<span class="sc">/</span><span class="er">*</span>.txt; \</span>
<span id="cb8-7"><a href="fave-align-legacy.html#cb8-7" aria-hidden="true" tabindex="-1"></a>do python FAAValign.py <span class="st">&quot;${i/.txt/.wav}&quot;</span> <span class="st">&quot;$i&quot;</span> <span class="st">&quot;${i/.txt/.TextGrid}&quot;</span>; \</span>
<span id="cb8-8"><a href="fave-align-legacy.html#cb8-8" aria-hidden="true" tabindex="-1"></a>done;</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="montreal-forced-aligner-v1-legacy.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="penn-forced-aligner-legacy.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
