<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Montreal Forced Aligner | Corpus Phonetics Tutorial</title>
  <meta name="description" content="A corpus phonetics tutorial" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Montreal Forced Aligner | Corpus Phonetics Tutorial" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://eleanorchodroff.com/tutorial/" />
  
  <meta property="og:description" content="A corpus phonetics tutorial" />
  <meta name="github-repo" content="echodroff/corpus-phonetics-tutorial" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Montreal Forced Aligner | Corpus Phonetics Tutorial" />
  
  <meta name="twitter:description" content="A corpus phonetics tutorial" />
  

<meta name="author" content="Eleanor Chodroff" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="kaldi.html"/>
<link rel="next" href="autovot.html"/>
<script src="libs/header-attrs-2.16/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><b><a href="https://eleanorchodroff.com/tutorial/index.html">Corpus Phonetics Tutorial</a></b></li>

<li class="divider"></li>
<li><a href="index.html#introduction" id="toc-introduction"><span class="toc-section-number">1</span> Introduction<span></span></a></li>
<li><a href="kaldi.html#kaldi" id="toc-kaldi"><span class="toc-section-number">2</span> Kaldi<span></span></a></li>
<li><a href="montreal-forced-aligner.html#montreal-forced-aligner" id="toc-montreal-forced-aligner"><span class="toc-section-number">3</span> Montreal Forced Aligner<span></span></a>
<ul>
<li><a href="montreal-forced-aligner.html#overview" id="toc-overview"><span class="toc-section-number">3.1</span> Overview<span></span></a></li>
<li><a href="montreal-forced-aligner.html#installation" id="toc-installation"><span class="toc-section-number">3.2</span> Installation<span></span></a></li>
<li><a href="montreal-forced-aligner.html#running-the-aligner" id="toc-running-the-aligner"><span class="toc-section-number">3.3</span> Running the aligner<span></span></a></li>
<li><a href="montreal-forced-aligner.html#file-preparation" id="toc-file-preparation"><span class="toc-section-number">3.4</span> File preparation<span></span></a>
<ul>
<li><a href="montreal-forced-aligner.html#audio-files" id="toc-audio-files"><span class="toc-section-number">3.4.1</span> Audio files<span></span></a></li>
<li><a href="montreal-forced-aligner.html#transcripts" id="toc-transcripts"><span class="toc-section-number">3.4.2</span> Transcripts<span></span></a></li>
<li><a href="montreal-forced-aligner.html#filenames" id="toc-filenames"><span class="toc-section-number">3.4.3</span> Filenames<span></span></a></li>
<li><a href="montreal-forced-aligner.html#input-and-output-folders" id="toc-input-and-output-folders"><span class="toc-section-number">3.4.4</span> Input and output folders<span></span></a></li>
</ul></li>
<li><a href="montreal-forced-aligner.html#obtaining-acoustic-models" id="toc-obtaining-acoustic-models"><span class="toc-section-number">3.5</span> Obtaining acoustic models<span></span></a>
<ul>
<li><a href="montreal-forced-aligner.html#download-an-acoustic-model" id="toc-download-an-acoustic-model"><span class="toc-section-number">3.5.1</span> Download an acoustic model<span></span></a></li>
<li><a href="montreal-forced-aligner.html#train-an-acoustic-model" id="toc-train-an-acoustic-model"><span class="toc-section-number">3.5.2</span> Train an acoustic model<span></span></a></li>
</ul></li>
<li><a href="montreal-forced-aligner.html#obtaining-dictionaries" id="toc-obtaining-dictionaries"><span class="toc-section-number">3.6</span> Obtaining dictionaries<span></span></a>
<ul>
<li><a href="montreal-forced-aligner.html#download-a-dictionary" id="toc-download-a-dictionary"><span class="toc-section-number">3.6.1</span> Download a dictionary<span></span></a></li>
<li><a href="montreal-forced-aligner.html#generate-a-dictionary-using-a-g2p-model" id="toc-generate-a-dictionary-using-a-g2p-model"><span class="toc-section-number">3.6.2</span> Generate a dictionary using a G2P model<span></span></a></li>
<li><a href="montreal-forced-aligner.html#train-a-g2p-model" id="toc-train-a-g2p-model"><span class="toc-section-number">3.6.3</span> Train a G2P model<span></span></a></li>
<li><a href="montreal-forced-aligner.html#create-the-dictionary-by-hand" id="toc-create-the-dictionary-by-hand"><span class="toc-section-number">3.6.4</span> Create the dictionary by hand<span></span></a></li>
</ul></li>
<li><a href="montreal-forced-aligner.html#tips-and-tricks" id="toc-tips-and-tricks"><span class="toc-section-number">3.7</span> Tips and tricks<span></span></a></li>
</ul></li>
<li><a href="autovot.html#autovot" id="toc-autovot"><span class="toc-section-number">4</span> AutoVOT<span></span></a>
<ul>
<li><a href="autovot.html#overview-1" id="toc-overview-1"><span class="toc-section-number">4.1</span> Overview<span></span></a></li>
<li><a href="autovot.html#simple-recipe" id="toc-simple-recipe"><span class="toc-section-number">4.2</span> Simple recipe<span></span></a></li>
<li><a href="autovot.html#full-recipe" id="toc-full-recipe"><span class="toc-section-number">4.3</span> Full recipe<span></span></a></li>
</ul></li>
<li><a href="bash-shell-basics.html#bash-shell-basics" id="toc-bash-shell-basics"><span class="toc-section-number">5</span> Bash Shell Basics<span></span></a>
<ul>
<li><a href="bash-shell-basics.html#introduction-1" id="toc-introduction-1"><span class="toc-section-number">5.1</span> Introduction<span></span></a></li>
<li><a href="bash-shell-basics.html#familiarization" id="toc-familiarization"><span class="toc-section-number">5.2</span> Familiarization<span></span></a></li>
<li><a href="bash-shell-basics.html#current-working-directory" id="toc-current-working-directory"><span class="toc-section-number">5.3</span> Current working directory<span></span></a></li>
<li><a href="bash-shell-basics.html#listing" id="toc-listing"><span class="toc-section-number">5.4</span> Listing<span></span></a></li>
<li><a href="bash-shell-basics.html#navigating" id="toc-navigating"><span class="toc-section-number">5.5</span> Navigating<span></span></a></li>
<li><a href="bash-shell-basics.html#creating-directories-and-files" id="toc-creating-directories-and-files"><span class="toc-section-number">5.6</span> Creating directories and files<span></span></a></li>
<li><a href="bash-shell-basics.html#copying-files" id="toc-copying-files"><span class="toc-section-number">5.7</span> Copying files<span></span></a></li>
<li><a href="bash-shell-basics.html#moving-files" id="toc-moving-files"><span class="toc-section-number">5.8</span> Moving files<span></span></a></li>
<li><a href="bash-shell-basics.html#batch-renaming-and-for-loops" id="toc-batch-renaming-and-for-loops"><span class="toc-section-number">5.9</span> Batch renaming and for loops<span></span></a></li>
<li><a href="bash-shell-basics.html#removing-files" id="toc-removing-files"><span class="toc-section-number">5.10</span> Removing files<span></span></a></li>
</ul></li>
<li><a href="other-resources.html#other-resources" id="toc-other-resources"><span class="toc-section-number">6</span> Other resources<span></span></a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Corpus Phonetics Tutorial</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="montreal-forced-aligner" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">3</span> Montreal Forced Aligner<a href="montreal-forced-aligner.html#montreal-forced-aligner" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="overview" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Overview<a href="montreal-forced-aligner.html#overview" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <a href="https://montreal-forced-aligner.readthedocs.io/en/latest/index.html" target="_blank">Montreal Forced Aligner</a> is a forced alignment system with acoustic models built using the <a href="https://eleanorchodroff.com/tutorial/kaldi/introduction.html" target="_blank">Kaldi ASR toolkit</a>. A major highlight of this system is the availability of pretrained acoustic models and grapheme-to-phoneme models for a wide variety of languages, as well as the ability to train acoustic and grapheme-to-phoneme models to any new dataset you might have. It also uses advanced techniques for training and aligning speech data (Kaldi) with a full suite of training and speaker adaptation algorithms. The basic acoustic model recipe uses the traditional GMM-HMM framework, starting with monophone models, then triphone models (which allow for context sensitivity, read: coarticulation), and some transformations and speaker adaptation along the way. You can check out more regarding the recipes in the <a href="https://montreal-forced-aligner.readthedocs.io/en/latest/">MFA user guide and reference guide</a>; for an overview to a standard training recipe, check out this <a href="https://www.eleanorchodroff.com/tutorial/kaldi/training-overview.html">Kaldi tutorial</a>.</p>
<p>As a forced alignment system, the Montreal Forced Aligner will time-align a transcript to a corresponding audio file at the phone and word levels provided there exist a set of pretrained acoustic models and a pronunciation dictionary (a.k.a. lexicon) of the words in the transcript with their canonical phonetic pronunciation(s).</p>
<p>The current MFA download contains a suite of <code>mfa</code> commands that allow you to do everything from basic forced alignment to grapheme-to-phoneme conversion to automatic speech recognition. In this tutorial, we’ll be focusing mostly on those commands relating to forced alignment and a side of grapheme-to-phoneme conversion.</p>
<p>Very generally, the procedure for forced alignment is as follows:</p>
<ul>
<li>Prep audio file(s)</li>
<li>Prep transcript(s) (Praat <code>TextGrids</code> or <code>.lab</code>/<code>.txt</code> files)</li>
<li>Obtain a pronunciation dictionary</li>
<li>Obtain an acoustic model</li>
<li>Create an input folder that contains the audio files and transcripts</li>
<li>Create an empty output folder</li>
<li>Run the <code>mfa align</code> command</li>
</ul>
</div>
<div id="installation" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Installation<a href="montreal-forced-aligner.html#installation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>You can find the streamlined installation instructions on the <a href="https://montreal-forced-aligner.readthedocs.io/en/latest/installation.html">main MFA installation page</a>. The majority of users will be following the “All platforms” instructions.</p>
<p>As listed there, you will need to download Miniconda or Anaconda. If you’re trying to decide between the two, I’d probably recommend Miniconda. Compared to Anaconda, Miniconda is smaller, and has a slightly higher success rate for installation. Conda is a package and environment management system. If you’re familiar with R, the package management system is similar in concept to the R CRAN server. Once installed, you can import sets of packages via the <code>conda</code> commands, similar to how you might run <code>install.packages</code> in R. The environment manager aspect of conda is fairly unique, and essentially creates a small environment on your computer for the collection of imported packages (here the MFA suite) to run. The primary advantage is that you don’t have to worry about conflicting versions of the same code package on your computer; the environment will be a bubble in your computer with the correct package versions for the MFA suite.</p>
<p>Once you’ve installed Miniconda/Anaconda, you’ll run the following line of code in the command line. For Mac users, the command line will be the terminal or a downloaded equivalent. For Windows users, <em>I believe</em> you will run this directly in the Miniconda console.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="montreal-forced-aligner.html#cb2-1" aria-hidden="true" tabindex="-1"></a>conda create <span class="sc">-</span>n aligner <span class="sc">-</span>c conda<span class="sc">-</span>forge montreal<span class="sc">-</span>forced<span class="sc">-</span>aligner</span></code></pre></div>
<p>The <code>-n</code> flag here refers to the <em>name</em> of the environment. If you want to test a new version of the aligner, but aren’t ready to overwrite your old working version of the aligner, you can create a new environment using a different name after the <code>-n</code> flag. See @ref(Tips and tricks) for more on conda environments.
If it’s worked, you should see something like:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="montreal-forced-aligner.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To activate this environment, use</span></span>
<span id="cb3-2"><a href="montreal-forced-aligner.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb3-3"><a href="montreal-forced-aligner.html#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#     $ conda activate aligner</span></span>
<span id="cb3-4"><a href="montreal-forced-aligner.html#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb3-5"><a href="montreal-forced-aligner.html#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># To deactivate an active environment, use</span></span>
<span id="cb3-6"><a href="montreal-forced-aligner.html#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb3-7"><a href="montreal-forced-aligner.html#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     $ conda deactivate</span></span></code></pre></div>
<p>And with that, the final step is <strong>activating</strong> the aligner. You will need to re-activate the aligner every time you open a new shell/command line window. You should be able to see which environment you have open in the parentheses before each shell prompt. For example, mine looks like:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="montreal-forced-aligner.html#cb4-1" aria-hidden="true" tabindex="-1"></a>(base) Eleanors<span class="sc">-</span>iPro<span class="sc">:</span>Documents eleanorchodroff<span class="sc">$</span> conda activate aligner</span>
<span id="cb4-2"><a href="montreal-forced-aligner.html#cb4-2" aria-hidden="true" tabindex="-1"></a>(aligner) Eleanors<span class="sc">-</span>iPro<span class="sc">:</span>Documents eleanorchodroff<span class="sc">$</span> </span></code></pre></div>
<p>You can run the aligner from any location on the computer as long as you’re in the aligner environment on the command line.</p>
<p><strong>NB:</strong> The Montreal Forced Aligner is now located in the <code>Documents/MFA</code> folder. All acoustic models, dictionaries, temporary alignment or training files, etc. will be stored in this folder. If you are ever confused or curious about what is happening with the aligner, just poke around this folder.</p>
</div>
<div id="running-the-aligner" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Running the aligner<a href="montreal-forced-aligner.html#running-the-aligner" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To run the aligner, we’ll need to follow this procedure:</p>
<ul>
<li>Prep audio file(s)</li>
<li>Prep transcript(s) (Praat <code>TextGrids</code> or <code>.lab</code>/<code>.txt</code> files)</li>
<li>Obtain a pronunciation dictionary</li>
<li>Obtain an acoustic model</li>
<li>Create an input folder that contains the audio files and transcripts</li>
<li>Create an empty output folder</li>
<li>Run the align command</li>
</ul>
<p>In this section, I will give a quick example of how this works using a hypothetical example of aligning American English. Through this, you’ll see the primary <code>mfa</code> commands that you’ll need for alignment. Then in the following sections, I’ll go into more detail about each of these steps.</p>
<p>For the first steps of prepping the audio files and prepping the transcripts, I’ll assume we’re working with a <code>wav</code> file and a Praat <code>TextGrid</code> that has a single interval tier with utterances transcribed in English. We can have multiple intervals per <code>TextGrid</code>. The <code>wav</code> file and <code>TextGrid</code> must have the same name.</p>
<p>After we have the audio files and transcript <code>TextGrids</code>, we’ll place them in an input folder. For the sake of this tutorial, this input folder will be called <code>Documents/input_english/</code>.</p>
<p>We will also need to create an empty output folder. I will call this output folder <code>Documents/output_english</code>.</p>
<p>We can then obtain the acoustic model from the internet (yes, you’ll have to be online the first time you do this) using the following command:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="montreal-forced-aligner.html#cb5-1" aria-hidden="true" tabindex="-1"></a>mfa model download acoustic english_us_arpa</span></code></pre></div>
<p>(You can also use <code>mfa models download acoustic english_us_arpa</code>.)</p>
<p>And we can obtain the dictionary from the internet using this command:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="montreal-forced-aligner.html#cb6-1" aria-hidden="true" tabindex="-1"></a>mfa model download dictionary english_us_arpa</span></code></pre></div>
<p>(You can also use <code>mfa models download dictionary english_us_arpa</code>.)</p>
<p>The dictionary and acoustic model can now be found in their respective <code>Documents/MFA/pretrained_models/</code> folders.</p>
<p>Once we have the dictionary, acoustic model, <code>wav</code> files and <code>TextGrids</code> in their input folder, and an empty output folder, then we’re ready to run the aligner!</p>
<p>The alignment command is called <code>align</code> and takes 4 arguments:</p>
<ul>
<li>path to the input folder</li>
<li>name of the acoustic model (in the <code>Documents/MFA/pretrained_models/acoustic/</code> folder) / path to the acoustic model if it’s elsewhere on the computer</li>
<li>name of the dictionary (in the <code>Documents/MFA/pretrained_models/dictionary/</code> folder) / path to the acoustic model if it’s elsewhere on the computer</li>
<li>path to the output folder</li>
</ul>
<p>I always add the optional <code>--clean</code> flag as this “cleans” out any old temporary files created in a previous run. (If you’re anything like me, you might find yourself re-running the aligner a few times, and with the same input filename. The aligner won’t actually re-run properly unless you clear out the old files.)</p>
<p><strong>Important:</strong> You will need to scroll across to see the whole line of code.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="montreal-forced-aligner.html#cb7-1" aria-hidden="true" tabindex="-1"></a>mfa align <span class="sc">--</span>clean <span class="sc">/</span>Users<span class="sc">/</span>Eleanor<span class="sc">/</span>Documents<span class="sc">/</span>input_english<span class="sc">/</span> english_us_arpa english_us_arpa <span class="sc">/</span>Users<span class="sc">/</span>Eleanor<span class="sc">/</span>Documents<span class="sc">/</span>output_english<span class="sc">/</span></span></code></pre></div>
<p>And if everything worked appropriately, your aligned <code>TextGrids</code> should now be in the <code>Documents/output_english/</code> folder!</p>
</div>
<div id="file-preparation" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> File preparation<a href="montreal-forced-aligner.html#file-preparation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="audio-files" class="section level3 hasAnchor" number="3.4.1">
<h3><span class="header-section-number">3.4.1</span> Audio files<a href="montreal-forced-aligner.html#audio-files" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The Montreal Forced Aligner is incredibly robust to audio files of differing formats, sampling rates and channels. You should not have to do much prep, but note that whatever you feed the system will be converted to be a <code>wav</code> file with a sampling rate of 16 kHz with a single (mono) channel unless otherwise specified (see <a href="https://montreal-forced-aligner.readthedocs.io/en/latest/user_guide/configuration/global.html##feature-config">Feature Configuration</a>. For the record, I have not yet tried any other file format except for <code>wav</code> files, so I’m not yet aware of potential issues that might arise there.</p>
</div>
<div id="transcripts" class="section level3 hasAnchor" number="3.4.2">
<h3><span class="header-section-number">3.4.2</span> Transcripts<a href="montreal-forced-aligner.html#transcripts" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The MFA can take as input either a Praat <code>TextGrid</code> or a <code>.lab</code> or <code>.txt</code> file. I have worked most extensively with the <code>TextGrid</code> input, so I’ll describe those details here. As for <code>.lab</code> and <code>.txt</code> input, I believe this method only works when the transcript is pasted in as a single line. In other words, I don’t think it can handle time stamps for utterance start and end times.</p>
</div>
<div id="filenames" class="section level3 hasAnchor" number="3.4.3">
<h3><span class="header-section-number">3.4.3</span> Filenames<a href="montreal-forced-aligner.html#filenames" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The filename of the <code>wav</code> file and its corresponding transcript must be identical except for the extension (<code>.wav</code> or <code>.TextGrid</code>). If you have multiple speakers in the alignment or training, you can actually implement some degree of speaker/channel adaptation. You can do this either by placing speaker-specific files in its own subfolder within the input folder, or by adding an optional argument to the <code>mfa align</code> command to use the first <code>n</code> characters of the filename.</p>
<p>If you go forward with this, it helps to have the speaker ID as the prefix to the filenamex. For example:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="montreal-forced-aligner.html#cb8-1" aria-hidden="true" tabindex="-1"></a>spkr01_utt1.wav, spkr01_utt1.TextGrid  </span>
<span id="cb8-2"><a href="montreal-forced-aligner.html#cb8-2" aria-hidden="true" tabindex="-1"></a>spkr01_utt2.wav, spkr01_utt2.TextGrid  </span>
<span id="cb8-3"><a href="montreal-forced-aligner.html#cb8-3" aria-hidden="true" tabindex="-1"></a>spkr02_utt1.wav, spkr02_utt1.TextGrid  </span>
<span id="cb8-4"><a href="montreal-forced-aligner.html#cb8-4" aria-hidden="true" tabindex="-1"></a>spkr02_utt2.wav, spkr02_utt2.TextGrid</span>
<span id="cb8-5"><a href="montreal-forced-aligner.html#cb8-5" aria-hidden="true" tabindex="-1"></a>spkr03_utt1.wav, spkr03_utt1.TextGrid  </span>
<span id="cb8-6"><a href="montreal-forced-aligner.html#cb8-6" aria-hidden="true" tabindex="-1"></a>spkr03_utt2.wav, spkr03_utt2.TextGrid  </span>
<span id="cb8-7"><a href="montreal-forced-aligner.html#cb8-7" aria-hidden="true" tabindex="-1"></a>spkr04_utt1.wav, spkr04_utt1.TextGrid  </span>
<span id="cb8-8"><a href="montreal-forced-aligner.html#cb8-8" aria-hidden="true" tabindex="-1"></a>spkr04_utt2.wav, spkr04_utt2.TextGrid</span></code></pre></div>
<p>In this case, we can then tell the aligner to use the first 6 characters as the speaker information. The <code>-s</code> flag stands for speaker characters.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="montreal-forced-aligner.html#cb9-1" aria-hidden="true" tabindex="-1"></a>mfa align <span class="sc">-</span>s <span class="dv">6</span> <span class="sc">--</span>clean <span class="sc">/</span>Users<span class="sc">/</span>Eleanor<span class="sc">/</span>input_english<span class="sc">/</span> english_us_arpa english_us_arpa <span class="sc">/</span>Users<span class="sc">/</span>Eleanor<span class="sc">/</span>output_english<span class="sc">/</span></span></code></pre></div>
<p>Alternatively:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="montreal-forced-aligner.html#cb10-1" aria-hidden="true" tabindex="-1"></a>mfa align <span class="sc">--</span>speaker_characters <span class="dv">6</span> <span class="sc">--</span>clean <span class="sc">/</span>Users<span class="sc">/</span>Eleanor<span class="sc">/</span>input_english<span class="sc">/</span> english_us_arpa english_us_arpa <span class="sc">/</span>Users<span class="sc">/</span>Eleanor<span class="sc">/</span>output_english<span class="sc">/</span></span></code></pre></div>
</div>
<div id="input-and-output-folders" class="section level3 hasAnchor" number="3.4.4">
<h3><span class="header-section-number">3.4.4</span> Input and output folders<a href="montreal-forced-aligner.html#input-and-output-folders" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>I would recommend creating a special input folder that houses a copy of your audio files and <code>TextGrid</code> transcripts. In case something goes wrong, you won’t be messing up the raw data. You can place this folder basically anywhere on your computer, and you can call this whatever you want.</p>
<p>You will also need to create an empty output folder. I recommend making sure this is empty each time you run the aligner as the aligner does not overwrite any existing files. You can place this folder basically anywhere on your computer, and you can call this whatever you want; however, you may not re-use the input folder as the output folder.</p>
</div>
</div>
<div id="obtaining-acoustic-models" class="section level2 hasAnchor" number="3.5">
<h2><span class="header-section-number">3.5</span> Obtaining acoustic models<a href="montreal-forced-aligner.html#obtaining-acoustic-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="download-an-acoustic-model" class="section level3 hasAnchor" number="3.5.1">
<h3><span class="header-section-number">3.5.1</span> Download an acoustic model<a href="montreal-forced-aligner.html#download-an-acoustic-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Pretrained acoustic models for several languages can be downloaded directly using the command line interface. This is the <a href="https://mfa-models.readthedocs.io/en/latest/acoustic/index.html">master list</a> of acoustic models available for download.</p>
</div>
<div id="train-an-acoustic-model" class="section level3 hasAnchor" number="3.5.2">
<h3><span class="header-section-number">3.5.2</span> Train an acoustic model<a href="montreal-forced-aligner.html#train-an-acoustic-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You can also train an acoustic model yourself directly on the data you’re working on. You do need a fair amount of data to get reasonable alignments out. If an existing acoustic model already exists, it might be worth simply using that directly on your data or you could try <a href="https://montreal-forced-aligner.readthedocs.io/en/latest/user_guide/workflows/adapt_acoustic_model.html">adapting</a> the model to your data. There are many cases, however, when training a new acoustic model is the best path forward.</p>
<p>The <code>mfa train</code> command takes 3 arguments:</p>
<ul>
<li>path to the input folder with the audio files and utterance-level transcripts (<code>TextGrids</code>)</li>
<li>name of the pronunciation dictionary in the <code>pretrained_models</code> folder or path to the pronunciation dictionary</li>
<li>path to the output folder (it still runs an alignment at the end)</li>
</ul>
<p>In other words, <code>mfa train</code> has the same syntax and requirements as the <code>mfa align</code> command, but without the acoustic model specification.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="montreal-forced-aligner.html#cb11-1" aria-hidden="true" tabindex="-1"></a>mfa train <span class="sc">--</span>clean <span class="sc">~</span><span class="er">/</span>Documents<span class="sc">/</span>input_spanish <span class="sc">~</span><span class="er">/</span>Documents<span class="sc">/</span>talnupf_spanish.txt <span class="sc">~</span><span class="er">/</span>Documents<span class="sc">/</span>output_spanish_textgrids</span></code></pre></div>
<p>Once again, I’m using the <code>--clean</code> flag just in case I need to clean out an old folder in <code>Documents/MFA</code>.</p>
<p>If you would like to reuse the acoustic model, you can find all of the trained models (there are several – one for each layer of training) in the associated folder in <code>Documents/MFA/</code> and any folder ending in <code>_ali</code>. I would recommend using the acoustic model from the last training and alignment pass, which is the <code>sat2_ali</code> folder. <code>sat2_ali</code> stands for the second round of Speaker Adaptive Training — alignment pass.</p>
<p>The <code>mfa model save acoustic</code> command takes one required argument, which is the path to the model you want to save, and an optional (but highly recommended) argument which is the new name of the acoustic model. The optional argument is specified after the <code>--name</code> flag:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="montreal-forced-aligner.html#cb12-1" aria-hidden="true" tabindex="-1"></a>mfa model save acoustic <span class="sc">--</span>name guarani_cv <span class="sc">~</span><span class="er">/</span>Documents<span class="sc">/</span>MFA<span class="sc">/</span>prep_validated_guarani<span class="sc">/</span>sat2_ali<span class="sc">/</span>acoustic_model.zip </span></code></pre></div>
</div>
</div>
<div id="obtaining-dictionaries" class="section level2 hasAnchor" number="3.6">
<h2><span class="header-section-number">3.6</span> Obtaining dictionaries<a href="montreal-forced-aligner.html#obtaining-dictionaries" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The pronunciation dictionary must be a two column text file with a list of words on the left-hand side and the phonetic pronunciation(s) on the right-hand side. Each word should be separated from its phonetic pronunciation by a tab, and each phone in the phonetic pronunciation should be separated by a space. Many-to-many mappings between words and pronunciations are permitted. In fact, you can even add <a href="https://montreal-forced-aligner.readthedocs.io/en/latest/user_guide/workflows/training_dictionary.html">pronunciation probabilities</a> to the dictionary, but I have not yet tried this!</p>
<p>One important point: the phone set in your dictionary must match that used in the acoustic models and the orthography must match that in the transcripts.</p>
<p>There are a few options for obtaining a pronunciation dictionary:</p>
<div id="download-a-dictionary" class="section level3 hasAnchor" number="3.6.1">
<h3><span class="header-section-number">3.6.1</span> Download a dictionary<a href="montreal-forced-aligner.html#download-a-dictionary" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This is the <a href="https://mfa-models.readthedocs.io/en/latest/dictionary/index.html">master list</a> of pre-existing pronunciation dictionaries available through the MFA. Click on the dictionary of interest, and if you scroll to the bottom of the page, it will tell you the name to type in the <code>mfa model download dictionary</code> command.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="montreal-forced-aligner.html#cb13-1" aria-hidden="true" tabindex="-1"></a>mfa model download dictionary spanish_latin_america_mfa</span></code></pre></div>
<p>NB: you must add any missing words in your corpus manually, or train a G2P model to handle these cases.</p>
</div>
<div id="generate-a-dictionary-using-a-g2p-model" class="section level3 hasAnchor" number="3.6.2">
<h3><span class="header-section-number">3.6.2</span> Generate a dictionary using a G2P model<a href="montreal-forced-aligner.html#generate-a-dictionary-using-a-g2p-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Grapheme-to-phoneme (G2P) models automatically convert the orthographic words in your corpus to the most likely phonetic pronunciation. How exactly it does this depends a lot on the type of model and its training data.</p>
<p>The MFA has a handful of pretrained G2P models that you can download. This is the <a href="https://mfa-models.readthedocs.io/en/latest/g2p/index.html">master list</a> of G2P models available for download.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="montreal-forced-aligner.html#cb14-1" aria-hidden="true" tabindex="-1"></a>mfa model download g2p bulgarian_mfa</span></code></pre></div>
<p>You’ll then use the <code>mfa g2p</code> command to generate the phonetic transcriptions from the submitted orthographic forms and the g2p model. The <code>mfa g2p</code> command takes 3 arguments:</p>
<ul>
<li>name of g2p model (in <code>Documents/MFA/pretrained_models/g2p/</code>)</li>
<li>path to the <code>TextGrids</code> or transcripts in your corpus</li>
<li>path to where the new pronunciation dictionary should go</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="montreal-forced-aligner.html#cb15-1" aria-hidden="true" tabindex="-1"></a>mfa g2p <span class="sc">--</span>clean bulgarian_mfa <span class="sc">~</span><span class="er">/</span>Desktop<span class="sc">/</span>romanian<span class="sc">/</span>TextGrids_with_new_words<span class="sc">/</span> <span class="er">~/</span>Desktop<span class="sc">/</span>new_bulgarian_dictionary.txt</span></code></pre></div>
<p>You can also use an external resource like <a href="https://github.com/dmort27/epitran">Epitran</a> or <a href="https://cohenpr-xpf.github.io/XPF/Convert-to-IPA.html">XPF</a> to generate a dictionary for you. These are both rule-based G2P systems built by linguists; these systems work to varying degrees of success.</p>
<p>In all cases, you’re best off checking the output. Remember that the phone set in the dictionary must entirely match the phone set in the acoustic model.</p>
</div>
<div id="train-a-g2p-model" class="section level3 hasAnchor" number="3.6.3">
<h3><span class="header-section-number">3.6.3</span> Train a G2P model<a href="montreal-forced-aligner.html#train-a-g2p-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You can also train a G2P model on an existing pronunciation dictionary. Once you’ve trained the G2P model, you’ll need to jump back up to the generate dictionary instructions just above. This might be useful in cases when you have many unlisted orthographic forms that are still in need of a phonetic transcription.</p>
<p>The <code>mfa train_g2p</code> command has 2 arguments:</p>
<ul>
<li>path to the training data pronunciation lexicon</li>
<li>path to where the trained G2P model should go</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="montreal-forced-aligner.html#cb16-1" aria-hidden="true" tabindex="-1"></a>mfa train_g2p <span class="sc">~</span><span class="er">/</span>Desktop<span class="sc">/</span>romanian<span class="sc">/</span>romanian_lexicon.txt <span class="sc">~</span><span class="er">/</span>Desktop<span class="sc">/</span>romanian<span class="sc">/</span>romanian_g2p</span></code></pre></div>
</div>
<div id="create-the-dictionary-by-hand" class="section level3 hasAnchor" number="3.6.4">
<h3><span class="header-section-number">3.6.4</span> Create the dictionary by hand<a href="montreal-forced-aligner.html#create-the-dictionary-by-hand" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This one is self-explanatory, but once again, make sure to use the same phone set as the acoustic models.</p>
</div>
</div>
<div id="tips-and-tricks" class="section level2 hasAnchor" number="3.7">
<h2><span class="header-section-number">3.7</span> Tips and tricks<a href="montreal-forced-aligner.html#tips-and-tricks" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Add <code>-h</code> after any command to get a help screen that will also display its argument structure. For example:</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="montreal-forced-aligner.html#cb17-1" aria-hidden="true" tabindex="-1"></a>mfa align <span class="sc">-</span>h</span>
<span id="cb17-2"><a href="montreal-forced-aligner.html#cb17-2" aria-hidden="true" tabindex="-1"></a>mfa train <span class="sc">-</span>h</span></code></pre></div>
<ul>
<li>Use the <code>--clean</code> flag each time you run the <code>align</code> command</li>
<li>Don’t forget to activate the aligner</li>
<li>Make sure the output folder is empty each time you run the <code>align</code> command</li>
<li>The input and output folders must be different folders</li>
<li>Many users have trouble reading/writing files to the Desktop folder. If you’re having issues using the Desktop, just switch to a different folder like Documents, or Google how to change the read/write permissions on your Desktop folder</li>
<li>And a little more on conda:</li>
</ul>
<p>If you have created multiple environments, you can list all of your environments using the following command:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="montreal-forced-aligner.html#cb18-1" aria-hidden="true" tabindex="-1"></a>conda info <span class="sc">--</span>envs</span></code></pre></div>
<p>You can delete an environment with the following command, where ENV_NAME is the name of the environment, like <code>aligner</code>. Make sure that you have deactivated the environment before deleting it.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="montreal-forced-aligner.html#cb19-1" aria-hidden="true" tabindex="-1"></a>conda deactivate</span>
<span id="cb19-2"><a href="montreal-forced-aligner.html#cb19-2" aria-hidden="true" tabindex="-1"></a>conda env remove <span class="sc">-</span>n ENV_NAME</span></code></pre></div>
<ul>
<li>You can inspect the details of any local acoustic model or dictionary using the <code>mfa model inspect</code> commands. One of the important outputs of this is the assumed phone set:</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="montreal-forced-aligner.html#cb20-1" aria-hidden="true" tabindex="-1"></a>mfa model inspect acoustic english_us_arpa</span>
<span id="cb20-2"><a href="montreal-forced-aligner.html#cb20-2" aria-hidden="true" tabindex="-1"></a>mfa model inspect dictionary english_us_arpa</span></code></pre></div>
<ul>
<li>You can get a list of the local acoustic models and dictionaries in your <code>Documents/MFA/pretrained_models/</code> folders using the <code>mfa model list</code> commands:</li>
</ul>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="montreal-forced-aligner.html#cb21-1" aria-hidden="true" tabindex="-1"></a>mfa model list acoustic</span>
<span id="cb21-2"><a href="montreal-forced-aligner.html#cb21-2" aria-hidden="true" tabindex="-1"></a>mfa model list dictionary</span></code></pre></div>
<ul>
<li>And finally, there is even more to the MFA than just what I’ve put here! Definitely poke around the MFA user guide to learn more and find special functions that might make your workflow even easier.</li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="kaldi.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="autovot.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
